(()=>{function e(e){if(e=(e=e&&e.shadowRoot)&&e.querySelector("hui-root")){const t=e.lovelace;return t.current_view=e.___curView,t}}const t="custom:";class s{constructor(){var t,s;this.addCardsToHeader(e(this.panel)),this.entityWatch(),t=this.main,s=t=>{window.HeaderCards.addCardsToHeader(e(t)),this.toolbar&&!this.toolbarObserver&&this.setupToolbarObserver(),this.panel&&!this.panelObserver&&this.setupPanelObserver()},new MutationObserver((function(e){e.forEach((({addedNodes:e})=>{for(let t of e)"ha-panel-lovelace"===t.localName&&setTimeout((()=>{s(t)}),100)}))})).observe(t.shadowRoot.querySelector("partial-panel-resolver"),{childList:!0}),this.header&&this.setupToolbarObserver(),this.panel&&this.setupPanelObserver()}setupToolbarObserver(){this.toolbarObserver=function(e,t){const s=new MutationObserver((function(e){e.forEach((({addedNodes:e})=>{for(let s of e)"app-toolbar"===s.localName&&"edit-mode"!==s.className&&setTimeout((()=>{t()}),100)}))}));return s.observe(e,{childList:!0}),s}(this.header,(()=>{window.HeaderCards.addCardsToHeader(e(this.panel))}))}setupPanelObserver(){this.panelObserver=function(e,t){const s=new MutationObserver((function(e){e.forEach((({addedNodes:e})=>{for(let s of e)"hui-root"===s.localName&&setTimeout((()=>{t()}),100)}))}));return s.observe(e.shadowRoot,{childList:!0}),s}(this.panel,(()=>{this.setupToolbarObserver()}))}get main(){let e=document.querySelector("home-assistant");return e=e&&e.shadowRoot,e=e&&e.querySelector("home-assistant-main"),e}get panel(){let e=this.main&&this.main.shadowRoot;return e=e&&e.querySelector("ha-drawer partial-panel-resolver"),e=e&&e.shadowRoot||e,e=e&&e.querySelector("ha-panel-lovelace"),e}get header(){let e=this.panel;return e=e&&e.shadowRoot,e=e&&e.querySelector("hui-root"),e=e&&e.shadowRoot,e=e&&e.querySelector("div.header"),e}get toolbar(){return this.header&&this.header.querySelector("div.toolbar")}get hass(){return this.main&&this.main.hass}async entityWatch(){(await window.hassConnection).conn.subscribeMessage((e=>this.entityWatchCallback(e)),{type:"subscribe_events",event_type:"state_changed"})}entityWatchCallback(e){if("state_changed"===e.event_type){let t=e.data.old_state&&e.data.old_state.state;(e.data.new_state&&e.data.new_state.state)!==t&&this.applyHass()}}addCard(e,t){let s=this.createCardElement(e);s.classList.add("header-card"),s.style.display="inline-block",s.hass=this.hass,t.appendChild(s)}addCardWhenDefined(e,s){let a=e.type;a.startsWith(t)?(a=a.substring(t.length),customElements.whenDefined(a).then((()=>{this.addCard(e,s)}))):this.addCard(e,s)}addBadge(e,t){let s=!0;if(e.visibility)for(let t of e.visibility)s=s&&this.checkStateCondition(t,this.hass);if(!s)return;let a=this.createBadgeElement(e);return a.classList.add("header-badge"),a.hass=this.hass,a.style.setProperty("--ha-label-badge-size","2em"),a.style.setProperty("--ha-label-badge-title-font-size","0.6em"),a.style.setProperty("--ha-label-badge-font-size","0.9em"),t.appendChild(a),a}checkStateCondition(e,t){const s=e.entity&&t.states[e.entity]?t.states[e.entity].state:"unknown";let a=e.state??e.state_not;if(Array.isArray(a)){const e=a.map((e=>this.getValueFromEntityId(t,e))).filter((e=>void 0!==e));a=[...a,...e]}else if("string"==typeof a){const e=this.getValueFromEntityId(t,a);a=[a],e&&a.push(e)}return null!=e.state?a.includes(s):!a.includes(s)}getValueFromEntityId(e,t){if(this.isValidEntityId(t)&&e.states[t])return e.states[t]?.state}isValidEntityId(e){return/^(\w+)\.(\w+)$/.test(e)}applyHass(){if(this.hass&&this.toolbar){let e=this.toolbar.querySelectorAll("#headerCards div .header-card,.header-badge");e&&e.forEach((e=>{e.hass=this.hass}))}}addCardsToHeader(e){window.loadCardHelpers().then((({createCardElement:t,createBadgeElement:s})=>{this.createCardElement=t,this.createBadgeElement=s;let a=(e.config||{}).header_cards||{},i=a.cards||[],r=a.badges||[],l=a&&a.replace_tabs||!1,o=this.toolbar&&this.toolbar.querySelector("ha-tabs"),d=this.toolbar&&this.toolbar.querySelector("div[main-title]"),n=this.toolbar&&this.toolbar.querySelector("div.action-items"),h=this.toolbar.querySelector("#headerCards");h&&h.remove();let c=a.justify_content||"right";if(i.length>0||r.length>0){let e=document.createElement("div");if(e.id="headerCards",e.style.display="flex",e.style.visibility="hidden",e.style["-ms-flex-direction"]="row",e.style["-webkit-flex-direction"]="row",e.style["flex-direction"]="row",e.style["-ms-flex-align"]="center",e.style["-webkit-align-items"]="center",e.style["align-items"]="center",e.style["justify-content"]=c,e.style.flex="1",r.length>0){let t=document.createElement("div");t.style.width="auto",t.style.minWidth="max-content",t.style.display="flex",t.style.gap="5px",r.forEach((e=>{this.addBadge(e,t)})),e.appendChild(t)}i.length>0&&i.forEach((t=>{let s=document.createElement("div");s.style.width="auto",s.style.minWidth="max-content",this.addCardWhenDefined(t,s),e.appendChild(s)})),n?this.toolbar.insertBefore(e,n):this.toolbar.appendChild(e),o||d?l?((o||d).style.display="none",e.style.visibility="visible"):setTimeout((function(){if(o){let t=o.shadowRoot&&o.shadowRoot.querySelector("#tabsContent");t.style.setProperty("width","auto","important");let s=t.offsetWidth;console.log("Tabs Width",s),o.style.width=`${s}px`,o.style.paddingRight="10px",e.style.visibility="visible"}else d.style.flex="0",d.style.paddingRight="10px",d.style.width="auto",d.style.minWidth="max-content",e.style.display="flex",e.style.visibility="visible"}),200):e.style.visibility="visible"}}))}}Promise.resolve(customElements.whenDefined("hui-view")).then((()=>{window.HeaderCards=new s}))})();